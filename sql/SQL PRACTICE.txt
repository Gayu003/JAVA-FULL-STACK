GROUP BY,HAVING FUNCTIONS,VIEWS

SQL> create table employee(id number,name varchar,salary number(9,2));
create table employee(id number,name varchar,salary number(9,2))
                                            *
ERROR at line 1:
ORA-00906: missing left parenthesis


SQL> create table employee(id number,name varchar(25),salary number(9,2));

Table created.

SQL> insert into employee values(101,dhana,50000.00);
insert into employee values(101,dhana,50000.00)
                                *
ERROR at line 1:
ORA-00984: column not allowed here


SQL> insert into employee values(101,'dhana',50000.00);

1 row created.

SQL> insert into employee values(102,'kishore',45000.00);

1 row created.

SQL> insert into employee values(103,'rabin',85000.00);

1 row created.

SQL> insert into employee values(103,'kathir',65000.00);

1 row created.

SQL> insert into employee values(105,'gowtham',65000.00);

1 row created.

SQL> select * from employee;

        ID NAME                          SALARY
---------- ------------------------- ----------
       101 dhana                          50000
       102 kishore                        45000
       103 rabin                          85000
       103 kathir                         65000
       105 gowtham                        65000

SQL> alter table employee add dept number;

Table altered.

SQL> select * from employee;

        ID NAME                          SALARY       DEPT
---------- ------------------------- ---------- ----------
       101 dhana                          50000
       102 kishore                        45000
       103 rabin                          85000
       103 kathir                         65000
       105 gowtham                        65000

SQL> update employee set dept=10 where id in(101,103);

3 rows updated.

SQL> select * from employee;

        ID NAME                          SALARY       DEPT
---------- ------------------------- ---------- ----------
       101 dhana                          50000         10
       102 kishore                        45000
       103 rabin                          85000         10
       103 kathir                         65000         10
       105 gowtham                        65000

SQL> update employee set dept=20 where id=102;

1 row updated.

SQL> select * from employee;

        ID NAME                          SALARY       DEPT
---------- ------------------------- ---------- ----------
       101 dhana                          50000         10
       102 kishore                        45000         20
       103 rabin                          85000         10
       103 kathir                         65000         10
       105 gowtham                        65000

SQL> update employee set dept=30 where id=105;

1 row updated.

SQL> select * from employee;

        ID NAME                          SALARY       DEPT
---------- ------------------------- ---------- ----------
       101 dhana                          50000         10
       102 kishore                        45000         20
       103 rabin                          85000         10
       103 kathir                         65000         10
       105 gowtham                        65000         30

SQL> select dept,count(*) from employee group by dept;

      DEPT   COUNT(*)
---------- ----------
        30          1
        20          1
        10          3

SQL> select dept,count(*),sum(salary),avg(salary),min(salary),max(salary) from employee group by dept;

      DEPT   COUNT(*) SUM(SALARY) AVG(SALARY) MIN(SALARY) MAX(SALARY)
---------- ---------- ----------- ----------- ----------- -----------
        30          1       65000       65000       65000       65000
        20          1       45000       45000       45000       45000
        10          3      200000  66666.6667       50000       85000

SQL> select dept,count(*),sum(salary),avg(salary),min(salary),max(salary) from employee group by dept order by dept;

      DEPT   COUNT(*) SUM(SALARY) AVG(SALARY) MIN(SALARY) MAX(SALARY)
---------- ---------- ----------- ----------- ----------- -----------
        10          3      200000  66666.6667       50000       85000
        20          1       45000       45000       45000       45000
        30          1       65000       65000       65000       65000

SQL> select dept,count(*),sum(salary),avg(salary),min(salary),max(salary) from employee group by dept having min(salary)>50000 order by dept;

      DEPT   COUNT(*) SUM(SALARY) AVG(SALARY) MIN(SALARY) MAX(SALARY)
---------- ---------- ----------- ----------- ----------- -----------
        30          1       65000       65000       65000       65000

SQL> select dept,count(*),sum(salary),avg(salary),min(salary),max(salary) from employee group by dept having min(salary)>50000 order by dept;

      DEPT   COUNT(*) SUM(SALARY) AVG(SALARY) MIN(SALARY) MAX(SALARY)
---------- ---------- ----------- ----------- ----------- -----------
        30          1       65000       65000       65000       65000

SQL> create table student(reg_no number(5) primary key,stu_name varchar2(20) not null,stu_age number(3) check (stu_age>0),stu_email varchar2(20) unique,stu_location varcha2(20) default 'Salem';
create table student(reg_no number(5) primary key,stu_name varchar2(20) not null,stu_age number(3) check (stu_age>0),stu_email varchar2(20) unique,stu_location varcha2(20) default 'Salem'
                                                                                                                                                                       *
ERROR at line 1:
ORA-00907: missing right parenthesis


SQL> create table student(reg_no number(5) primary key,stu_name varchar2(20) not null,stu_age number(3) check (stu_age>0),stu_email varchar2(20) unique,stu_location varcha2(20) default 'Salem');
create table student(reg_no number(5) primary key,stu_name varchar2(20) not null,stu_age number(3) check (stu_age>0),stu_email varchar2(20) unique,stu_location varcha2(20) default 'Salem')
                                                                                                                                                                       *
ERROR at line 1:
ORA-00907: missing right parenthesis


SQL> create table student(reg_no number(5) primary key,stu_name varchar2(20) not null,stu_age number(3) check (stu_age>0),stu_email varchar2(20) unique,stu_location varcha2(20) default 'Salem');
create table student(reg_no number(5) primary key,stu_name varchar2(20) not null,stu_age number(3) check (stu_age>0),stu_email varchar2(20) unique,stu_location varcha2(20) default 'Salem')
                                                                                                                                                                       *
ERROR at line 1:
ORA-00907: missing right parenthesis


SQL> create table student(reg_no number(5) primary key,stu_name varchar2(20) not null,stu_age number(3) check (stu_age>0),stu_email varchar2(20) unique,stu_location varchar2(20) default 'Salem');

Table created.

SQL> desc student;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 REG_NO                                    NOT NULL NUMBER(5)
 STU_NAME                                  NOT NULL VARCHAR2(20)
 STU_AGE                                            NUMBER(3)
 STU_EMAIL                                          VARCHAR2(20)
 STU_LOCATION                                       VARCHAR2(20)

SQL> insert into student(reg_no,stu_name,stu_age,stu_email) values(101,'selva',-12,'abc@gmail.com');
insert into student(reg_no,stu_name,stu_age,stu_email) values(101,'selva',-12,'abc@gmail.com')
*
ERROR at line 1:
ORA-02290: check constraint (SYSTEM.SYS_C006998) violated


SQL> insert into student(reg_no,stu_name,stu_age,stu_email) values(101,'selva',12,'abc@gmail.com');

1 row created.

SQL> select * from student;

    REG_NO STU_NAME                STU_AGE STU_EMAIL
---------- -------------------- ---------- --------------------
STU_LOCATION
--------------------
       101 selva                        12 abc@gmail.com
Salem


SQL> insert into student(reg_no,stu_name,stu_age,stu_email) values(102,'gayathri',12,'abc@gmail.com');
insert into student(reg_no,stu_name,stu_age,stu_email) values(102,'gayathri',12,'abc@gmail.com')
*
ERROR at line 1:
ORA-00001: unique constraint (SYSTEM.SYS_C007000) violated


SQL> insert into student values(103,'ramya',18,'abcd@gmail.com','Erode');

1 row created.

SQL> select * from student;

    REG_NO STU_NAME                STU_AGE STU_EMAIL
---------- -------------------- ---------- --------------------
STU_LOCATION
--------------------
       101 selva                        12 abc@gmail.com
Salem

       103 ramya                        18 abcd@gmail.com
Erode


SQL> create table department(dno number(5)primary key,dname varchar2(20));

Table created.

SQL> create table emp(eid number(5)primary key,ename varchar2(20),esalary number(5),dno number(5),foreign key(dno) references department
  2  (dno));
create table emp(eid number(5)primary key,ename varchar2(20),esalary number(5),dno number(5),foreign key(dno) references department
             *
ERROR at line 1:
ORA-00955: name is already used by an existing object


SQL> GROUP BY clause is used with the SELECT statement.
SP2-0734: unknown command beginning "GROUP BY c..." - rest of line ignored.
SQL> In the query, the GROUP BY clause is placed after the WHERE clause.
SQL> In the query, the GROUP BY clause is placed before the ORDER BY clause if used.
SQL> In the query, the Group BY clause is placed before the Having clause.
SQL> Place condition in the having clause.
SP2-0734: unknown command beginning "Place cond..." - rest of line ignored.
SQL> create table emp1(eid number(5)primary key,ename varchar2(20),esalary number(5),dno number(5),foreign key(dno) references department(dno));

Table created.

SQL> insert into department values(10,'CSE');

1 row created.

SQL> insert into emp1 values(101,'Harish',60000,10);

1 row created.

SQL> insert into emp1 values(102,'gayathri',50000,10);

1 row created.

SQL> insert into department values(20,'CSE');

1 row created.

SQL> insert into emp1 values(103,'gayu',50000,20);

1 row created.

SQL> select * from department;

       DNO DNAME
---------- --------------------
        10 CSE
        20 CSE

SQL> select * from emp1;

       EID ENAME                   ESALARY        DNO
---------- -------------------- ---------- ----------
       101 Harish                    60000         10
       102 gayathri                  50000         10
       103 gayu                      50000         20

SQL> create view view1 as select * from emp1 where dno=10;

View created.

SQL> select * from view1;

       EID ENAME                   ESALARY        DNO
---------- -------------------- ---------- ----------
       101 Harish                    60000         10
       102 gayathri                  50000         10

SQL> update view1 set esalary=70000 where eid=102;

1 row updated.

SQL> select * from view1;

       EID ENAME                   ESALARY        DNO
---------- -------------------- ---------- ----------
       101 Harish                    60000         10
       102 gayathri                  70000         10

SQL> select * from emp1;

       EID ENAME                   ESALARY        DNO
---------- -------------------- ---------- ----------
       101 Harish                    60000         10
       102 gayathri                  70000         10
       103 gayu                      50000         20

SQL> select eid as "Employee Id", ename as "Employee Name" from emp1;

Employee Id Employee Name
----------- --------------------
        101 Harish
        102 gayathri
        103 gayu

JOINS,SUBQUERIES

SQL> select * from agents;

AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
A101                 agent1               chennai
A102                 agent2               chennai
A103                 agent3               bangalore
A104                 agent4               bangalore

SQL> select * from customers;

no rows selected

SQL> select * from customers;

no rows selected

SQL> create table customers(customer_code varchar2(20),customer_name varchar2(20),customer_area varchar2(20));
create table customers(customer_code varchar2(20),customer_name varchar2(20),customer_area varchar2(20))
             *
ERROR at line 1:
ORA-00955: name is already used by an existing object


SQL> drop table customers;

Table dropped.

SQL> create table customers(customer_code varchar2(20),customer_name varchar2(20),customer_area varchar2(20));

Table created.

SQL> insert into customers values('C101','customer1','chennai');

1 row created.

SQL> insert into customers values('C102','customer2','chennai');

1 row created.

SQL> insert into customers values('C103','customer3','chennai');

1 row created.

SQL> insert into customers values('C104','customer4','Bangalore');

1 row created.

SQL> insert into customers values('C105','customer5','Bangalore');

1 row created.

SQL> select * from customers;

CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
C101                 customer1            chennai
C102                 customer2            chennai
C103                 customer3            chennai
C104                 customer4            Bangalore
C105                 customer5            Bangalore

SQL> select a.agent_name,c.customer_name,c.customer_area from agents a,customers c where a.working_area=c.customer_area;

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent2               customer1            chennai
agent1               customer1            chennai
agent2               customer2            chennai
agent1               customer2            chennai
agent2               customer3            chennai
agent1               customer3            chennai

6 rows selected.

SQL> select a.agent_name,c.customer_name,c.customer_area from agents a join customers c on a.working_area=c.customer_area;

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent2               customer1            chennai
agent1               customer1            chennai
agent2               customer2            chennai
agent1               customer2            chennai
agent2               customer3            chennai
agent1               customer3            chennai

6 rows selected.

SQL> select agents.agent_name,customers.customer_name,customers.customer_area from agents join customers on agents.working_area=customers.customer_area;

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent2               customer1            chennai
agent1               customer1            chennai
agent2               customer2            chennai
agent1               customer2            chennai
agent2               customer3            chennai
agent1               customer3            chennai

6 rows selected.

SQL> insert into agents values('A105','agent5','New York');

1 row created.

SQL> insert into customers values('C106','customer6','Delhi');

1 row created.

SQL> select * from customers;

CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
C101                 customer1            chennai
C102                 customer2            chennai
C103                 customer3            chennai
C104                 customer4            Bangalore
C105                 customer5            Bangalore
C106                 customer6            Delhi

6 rows selected.

SQL> select * from agents;

AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
A101                 agent1               chennai
A102                 agent2               chennai
A103                 agent3               bangalore
A104                 agent4               bangalore
A105                 agent5               New York

SQL> select *from agents left outer join customers on agents.working_area=customers.customer_area;

AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A102                 agent2               chennai
C101                 customer1            chennai

A101                 agent1               chennai
C101                 customer1            chennai

A102                 agent2               chennai
C102                 customer2            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A101                 agent1               chennai
C102                 customer2            chennai

A102                 agent2               chennai
C103                 customer3            chennai

A101                 agent1               chennai
C103                 customer3            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A105                 agent5               New York


A104                 agent4               bangalore


A103                 agent3               bangalore



9 rows selected.

SQL> select *from agents left join customers on agents.working_area=customers.customer_area;

AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A102                 agent2               chennai
C101                 customer1            chennai

A101                 agent1               chennai
C101                 customer1            chennai

A102                 agent2               chennai
C102                 customer2            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A101                 agent1               chennai
C102                 customer2            chennai

A102                 agent2               chennai
C103                 customer3            chennai

A101                 agent1               chennai
C103                 customer3            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A105                 agent5               New York


A104                 agent4               bangalore


A103                 agent3               bangalore



9 rows selected.

SQL> select *from agents right join customers on agents.working_area=customers.customer_area;

AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A101                 agent1               chennai
C103                 customer3            chennai

A101                 agent1               chennai
C102                 customer2            chennai

A101                 agent1               chennai
C101                 customer1            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A102                 agent2               chennai
C103                 customer3            chennai

A102                 agent2               chennai
C102                 customer2            chennai

A102                 agent2               chennai
C101                 customer1            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------

C105                 customer5            Bangalore


C104                 customer4            Bangalore


C106                 customer6            Delhi


9 rows selected.

SQL> select *from agents full join customers on agents.working_area=customers.customer_area;

AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A102                 agent2               chennai
C101                 customer1            chennai

A101                 agent1               chennai
C101                 customer1            chennai

A102                 agent2               chennai
C102                 customer2            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A101                 agent1               chennai
C102                 customer2            chennai

A102                 agent2               chennai
C103                 customer3            chennai

A101                 agent1               chennai
C103                 customer3            chennai


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------

C104                 customer4            Bangalore


C105                 customer5            Bangalore


C106                 customer6            Delhi


AGENT_CODE           AGENT_NAME           WORKING_AREA
-------------------- -------------------- --------------------
CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
A105                 agent5               New York


A104                 agent4               bangalore


A103                 agent3               bangalore



12 rows selected.

SQL> select a.agent_code,b.agent_name from agents a,agents b where a.working_area=b.working_area;

AGENT_CODE           AGENT_NAME
-------------------- --------------------
A102                 agent1
A101                 agent1
A102                 agent2
A101                 agent2
A104                 agent3
A103                 agent3
A104                 agent4
A103                 agent4
A105                 agent5

9 rows selected.

SQL> select agents.agent_name,customers.customer_name,customers.customer_area from agents cross join customers;

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent1               customer1            chennai
agent1               customer2            chennai
agent1               customer3            chennai
agent1               customer4            Bangalore
agent1               customer5            Bangalore
agent1               customer6            Delhi
agent2               customer1            chennai
agent2               customer2            chennai
agent2               customer3            chennai
agent2               customer4            Bangalore
agent2               customer5            Bangalore

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent2               customer6            Delhi
agent3               customer1            chennai
agent3               customer2            chennai
agent3               customer3            chennai
agent3               customer4            Bangalore
agent3               customer5            Bangalore
agent3               customer6            Delhi
agent4               customer1            chennai
agent4               customer2            chennai
agent4               customer3            chennai
agent4               customer4            Bangalore

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent4               customer5            Bangalore
agent4               customer6            Delhi
agent5               customer1            chennai
agent5               customer2            chennai
agent5               customer3            chennai
agent5               customer4            Bangalore
agent5               customer5            Bangalore
agent5               customer6            Delhi

30 rows selected.

SQL> select agents.agent_name,customers.customer_name,customers.customer_area from agents natural join customers;

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent1               customer1            chennai
agent1               customer2            chennai
agent1               customer3            chennai
agent1               customer4            Bangalore
agent1               customer5            Bangalore
agent1               customer6            Delhi
agent2               customer1            chennai
agent2               customer2            chennai
agent2               customer3            chennai
agent2               customer4            Bangalore
agent2               customer5            Bangalore

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent2               customer6            Delhi
agent3               customer1            chennai
agent3               customer2            chennai
agent3               customer3            chennai
agent3               customer4            Bangalore
agent3               customer5            Bangalore
agent3               customer6            Delhi
agent4               customer1            chennai
agent4               customer2            chennai
agent4               customer3            chennai
agent4               customer4            Bangalore

AGENT_NAME           CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
agent4               customer5            Bangalore
agent4               customer6            Delhi
agent5               customer1            chennai
agent5               customer2            chennai
agent5               customer3            chennai
agent5               customer4            Bangalore
agent5               customer5            Bangalore
agent5               customer6            Delhi

30 rows selected.

SQL> select * from customers where customer_area=(select working_area from agents where working_area='A101');

no rows selected

SQL> select * from customers where customer_area=(select working_area from agents where agent_code='A101');

CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
C101                 customer1            chennai
C102                 customer2            chennai
C103                 customer3            chennai

SQL> select * from customers where customer_area=(select working_area from agents where working_area='chennai');
select * from customers where customer_area=(select working_area from agents where working_area='chennai')
                                             *
ERROR at line 1:
ORA-01427: single-row subquery returns more than one row


SQL> select * from customers where customer_area=(select working_area from agents where working_area='delhi');

no rows selected

SQL> select * from customers where customer_area=(select working_area from agents where working_area='New York');

no rows selected

SQL> select * from customers where customer_area=(select working_area from agents where working_area in('chennai');
select * from customers where customer_area=(select working_area from agents where working_area in('chennai')
                                             *
ERROR at line 1:
ORA-00921: unexpected end of SQL command


SQL> select * from customers where customer_area=(select working_area from agents where working_area in ('chennai','delhi');
select * from customers where customer_area=(select working_area from agents where working_area in ('chennai','delhi')
                                             *
ERROR at line 1:
ORA-00921: unexpected end of SQL command


SQL> select * from customers where customer_area=(select working_area from agents where working_area in (chennai,delhi);
select * from customers where customer_area=(select working_area from agents where working_area in (chennai,delhi)
                                             *
ERROR at line 1:
ORA-00921: unexpected end of SQL command


SQL> select * from customers where customer_area in (select working_area from agents where working_area='chennai');

CUSTOMER_CODE        CUSTOMER_NAME        CUSTOMER_AREA
-------------------- -------------------- --------------------
C103                 customer3            chennai
C102                 customer2            chennai
C101                 customer1            chennai
